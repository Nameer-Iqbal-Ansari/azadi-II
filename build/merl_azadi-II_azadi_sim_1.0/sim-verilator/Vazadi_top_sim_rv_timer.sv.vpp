`begin_keywords "1800-2017"
`line 1 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 1
 
 
 

`line 5 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
module rv_timer (
  input logic clk_i,
  input logic rst_ni,

`line 9 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
  input  tlul_pkg::tlul_h2d_t tl_i,
  output tlul_pkg::tlul_d2h_t tl_o,

`line 12 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
  output logic irq_timer_o
);

`line 15 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
  localparam int N_HARTS  = 1;
  localparam int N_TIMERS = 1;

`line 18 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
  import rv_timer_reg_pkg::*;

`line 20 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
  rv_timer_reg2hw_t reg2hw;
  rv_timer_hw2reg_t hw2reg;

`line 23 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
  logic [N_HARTS-1:0] active;

`line 25 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
  logic [11:0] prescaler [N_HARTS];
  logic [7:0]  step      [N_HARTS];

`line 28 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
  logic [N_HARTS-1:0] tick;

`line 30 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
  logic [63:0] mtime_d  [N_HARTS];
  logic [63:0] mtime    [N_HARTS];
  logic [63:0] mtimecmp [N_HARTS][N_TIMERS];  
  logic        mtimecmp_update [N_HARTS][N_TIMERS];

`line 35 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
  logic [N_HARTS*N_TIMERS-1:0] intr_timer_set;
  logic [N_HARTS*N_TIMERS-1:0] intr_timer_en;
  logic [N_HARTS*N_TIMERS-1:0] intr_timer_test_q;
  logic [N_HARTS-1:0]          intr_timer_test_qe;
  logic [N_HARTS*N_TIMERS-1:0] intr_timer_state_q;
  logic [N_HARTS-1:0]          intr_timer_state_de;
  logic [N_HARTS*N_TIMERS-1:0] intr_timer_state_d;

`line 43 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
  logic [N_HARTS*N_TIMERS-1:0] intr_out;

`line 45 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
   
   
   

`line 49 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
   
   
  assign active[0]  = reg2hw.ctrl[0].q;
  assign prescaler = '{reg2hw.cfg0.prescale.q};
  assign step      = '{reg2hw.cfg0.step.q};

`line 55 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
  assign hw2reg.timer_v_upper0.de = tick[0];
  assign hw2reg.timer_v_lower0.de = tick[0];
  assign hw2reg.timer_v_upper0.d = mtime_d[0][63:32];
  assign hw2reg.timer_v_lower0.d = mtime_d[0][31: 0];
  assign mtime[0] = {reg2hw.timer_v_upper0.q, reg2hw.timer_v_lower0.q};
  assign mtimecmp = '{'{{reg2hw.compare_upper0_0.q,reg2hw.compare_lower0_0.q}}};
  assign mtimecmp_update[0][0] = reg2hw.compare_upper0_0.qe | reg2hw.compare_lower0_0.qe;

`line 63 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
  assign irq_timer_o              = intr_out[0];
  assign intr_timer_en            = reg2hw.intr_enable0[0].q;
  assign intr_timer_state_q       = reg2hw.intr_state0[0].q;
  assign intr_timer_test_q        = reg2hw.intr_test0[0].q;
  assign intr_timer_test_qe       = reg2hw.intr_test0[0].qe;
  assign hw2reg.intr_state0[0].de = intr_timer_state_de | mtimecmp_update[0][0];
  assign hw2reg.intr_state0[0].d  = intr_timer_state_d & ~mtimecmp_update[0][0];


`line 72 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
  for (genvar h = 0 ; h < N_HARTS ; h++) begin : gen_harts
    prim_intr_hw #(
      .Width(N_TIMERS)
    ) u_intr_hw (
      .clk_i,
      .rst_ni,
      .event_intr_i           (intr_timer_set),

`line 80 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
      .reg2hw_intr_enable_q_i (intr_timer_en[h*N_TIMERS+:N_TIMERS]),
      .reg2hw_intr_test_q_i   (intr_timer_test_q[h*N_TIMERS+:N_TIMERS]),
      .reg2hw_intr_test_qe_i  (intr_timer_test_qe[h]),
      .reg2hw_intr_state_q_i  (intr_timer_state_q[h*N_TIMERS+:N_TIMERS]),
      .hw2reg_intr_state_de_o (intr_timer_state_de),
      .hw2reg_intr_state_d_o  (intr_timer_state_d[h*N_TIMERS+:N_TIMERS]),

`line 87 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
      .intr_o                 (intr_out[h*N_TIMERS+:N_TIMERS])
    );

`line 90 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
    timer_core #(
      .N (N_TIMERS)
    ) u_core (
      .clk_i,
      .rst_ni,

`line 96 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
      .active    (active[h]),
      .prescaler (prescaler[h]),
      .step      (step[h]),

`line 100 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
      .tick      (tick[h]),

`line 102 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
      .mtime_d   (mtime_d[h]),
      .mtime     (mtime[h]),
      .mtimecmp  (mtimecmp[h]),

`line 106 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
      .intr      (intr_timer_set[h*N_TIMERS+:N_TIMERS])
    );
  end : gen_harts

`line 110 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
   
  rv_timer_reg_top u_reg (
    .clk_i,
    .rst_ni,

`line 115 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
    .tl_i,
    .tl_o,

`line 118 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
    .reg2hw,
    .hw2reg,

`line 121 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
    .devmode_i  (1'b1)
  );


`line 125 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 0
endmodule

`line 127 "../src/merl_azadi-II_azadi_rv_timer_1.0/rtl/rv_timer.sv" 2
