`begin_keywords "1800-2017"
`line 1 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 1
 
 
 

`line 5 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
 

`line 7 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
 
 

`line 10 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
 
 
 

`line 14 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
module rv_plic_target #(
  parameter int N_SOURCE = 37,
  parameter int MAX_PRIO = 2,

`line 18 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
   
  localparam int SrcWidth  = $clog2(N_SOURCE+1),   
  localparam int PrioWidth = $clog2(MAX_PRIO+1)    
) (
  input logic clk_i,
  input logic rst_ni,

`line 25 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
  input logic [N_SOURCE-1:0]  ip_i,
  input logic [N_SOURCE-1:0]  ie_i,

`line 28 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
  input logic [PrioWidth-1:0] prio_i [N_SOURCE],
  input logic [PrioWidth-1:0] threshold_i,

`line 31 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
  output logic            irq_o,
  output logic [SrcWidth-1:0] irq_id_o
);

`line 35 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
   


`line 38 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
   
   
  localparam int NumLevels = $clog2(N_SOURCE);
  logic [2**(NumLevels+1)-2:0]            is_tree;
  logic [2**(NumLevels+1)-2:0][SrcWidth-1:0]  id_tree;
  logic [2**(NumLevels+1)-2:0][PrioWidth-1:0] max_tree;

`line 45 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
  for (genvar level = 0; level < NumLevels+1; level++) begin : gen_tree
    
     
     
     
     
    
     
     
     
     
    
    localparam int Base0 = (2**level)-1;
    localparam int Base1 = (2**(level+1))-1;

`line 60 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
    for (genvar offset = 0; offset < 2**level; offset++) begin : gen_level
      localparam int Pa = Base0 + offset;
      localparam int C0 = Base1 + 2*offset;
      localparam int C1 = Base1 + 2*offset + 1;

`line 65 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
       
       
      if (level == NumLevels) begin : gen_leafs
        if (offset < N_SOURCE) begin : gen_assign
          assign is_tree[Pa]  = ip_i[offset] & ie_i[offset];
          assign id_tree[Pa]  = offset;
          assign max_tree[Pa] = prio_i[offset];
        end else begin : gen_tie_off
          assign is_tree[Pa]  = '0;
          assign id_tree[Pa]  = '0;
          assign max_tree[Pa] = '0;
        end
       
      end else begin : gen_nodes
         
         
         
         
        
         
         
        
         
         
         
         

`line 92 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
        logic sel;  
         
         
        assign sel = (~is_tree[C0] & is_tree[C1]) |
                     (is_tree[C0] & is_tree[C1] & logic'(max_tree[C1] > max_tree[C0]));
         
        assign is_tree[Pa]  = (sel              & is_tree[C1])  | ((~sel)            & is_tree[C0]);
        assign id_tree[Pa]  = ({SrcWidth{sel}}  & id_tree[C1])  | ({SrcWidth{~sel}}  & id_tree[C0]);
        assign max_tree[Pa] = ({PrioWidth{sel}} & max_tree[C1]) | ({PrioWidth{~sel}} & max_tree[C0]);
      end
    end : gen_level
  end : gen_tree

`line 105 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
  logic irq_d, irq_q;
  logic [SrcWidth-1:0] irq_id_d, irq_id_q;

`line 108 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
   
  assign irq_d    = (max_tree[0] > threshold_i) ? is_tree[0] : 1'b0;
  assign irq_id_d = (is_tree[0]) ? id_tree[0] : '0;

`line 112 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
  always_ff @(posedge clk_i or negedge rst_ni) begin : gen_regs
    if (!rst_ni) begin
      irq_q    <= 1'b0;
      irq_id_q <= '0;
    end else begin
      irq_q    <= irq_d;
      irq_id_q <= irq_id_d;
    end
  end

`line 122 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
  assign irq_o    = irq_q;
  assign irq_id_o = irq_id_q;

`line 125 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 0
endmodule


`line 128 "../src/merl_azadi-II_azadi_rv_plic_1.0/rtl/rv_plic_target.sv" 2
