`begin_keywords "1800-2017"
`line 1 "../src/merl_azadi-II_azadi_spi_host_1.0/rtl/spi_controller_iccm.sv" 1
 
 
 

`line 5 "../src/merl_azadi-II_azadi_spi_host_1.0/rtl/spi_controller_iccm.sv" 0
 

`line 7 "../src/merl_azadi-II_azadi_spi_host_1.0/rtl/spi_controller_iccm.sv" 0
module spi_controller_iccm #(
  parameter ADDR_WIDTH = 13
)(
  input  logic  clk_i,
  input  logic  rst_ni,
   
  input  logic  sck_i,
  input  logic  sdi_i,
  input  logic  csb_i,
  output logic  sdo_o,
   
  output logic [ADDR_WIDTH-1:0] waddr_o,
  output logic [31:0]           wdata_o,
  output logic                  wvalid_o
);
   
   
   
  localparam logic [31:0] ENDING_INSTRUCTION = 32'h7F87_8000 ;  

`line 27 "../src/merl_azadi-II_azadi_spi_host_1.0/rtl/spi_controller_iccm.sv" 0
   
   
   
  logic                  csb_rst;
  logic [ADDR_WIDTH-1:0] waddr_q;
  logic [31:0]           wdata_q;
  logic                  wvalid_q;
  logic [ADDR_WIDTH-1:0] waddr_qs;  
  logic [31:0]           wdata_qs;
  logic                  wvalid_qs;
  logic                  sdo_q;
  logic [31:0]           cntr_q;     
  logic [31:0]           wdata_swp;  

`line 41 "../src/merl_azadi-II_azadi_spi_host_1.0/rtl/spi_controller_iccm.sv" 0
  assign csb_rst = ~csb_i | rst_ni;

`line 43 "../src/merl_azadi-II_azadi_spi_host_1.0/rtl/spi_controller_iccm.sv" 0
   
   
   
  always_ff @ (negedge sck_i or negedge csb_rst) begin
    if (!csb_rst) begin
      waddr_q   <= '0;
      wdata_q   <= '0;
      wvalid_q  <= '0;
      waddr_qs  <= '0;
      wdata_qs  <= '0;
      wvalid_qs <= '0;
      cntr_q    <= '0;
      sdo_q     <= '0;
    end else begin
      if (wdata_q == ENDING_INSTRUCTION) begin
         
        wvalid_q <= 1'b0;
        sdo_q    <= 1'b1;  
      end else begin
         
        wdata_q   <= {wdata_q[30:0], sdi_i};
        wvalid_qs <= wvalid_q;  

`line 66 "../src/merl_azadi-II_azadi_spi_host_1.0/rtl/spi_controller_iccm.sv" 0
         
        if (wvalid_q) begin
          wdata_qs  <= wdata_q;
          waddr_qs  <= waddr_q;
        end

`line 72 "../src/merl_azadi-II_azadi_spi_host_1.0/rtl/spi_controller_iccm.sv" 0
         
        if (cntr_q[30]) begin
          cntr_q   <= '0;    
          wvalid_q <= 1'b1;
        end else begin
          wvalid_q <= 1'b0;
          waddr_q  <= waddr_q + wvalid_q;  
          cntr_q   <= {cntr_q[30:0], 1'b1};
        end
      end
    end
  end

`line 85 "../src/merl_azadi-II_azadi_spi_host_1.0/rtl/spi_controller_iccm.sv" 0
   
   
   
  logic [ADDR_WIDTH-1:0] waddr_q_dst,  waddr_qq_dst;
  logic [31:0]           wdata_q_dst,  wdata_qq_dst;
  logic                  wvalid_q_dst, wvalid_qq_dst;

`line 92 "../src/merl_azadi-II_azadi_spi_host_1.0/rtl/spi_controller_iccm.sv" 0
   
  always_ff @(posedge clk_i or negedge rst_ni) begin
    if (!rst_ni) begin
      waddr_q_dst   <= '0;
      wdata_q_dst   <= '0;
      wvalid_q_dst  <= '0;
      waddr_qq_dst  <= '0;
      wdata_qq_dst  <= '0;
      wvalid_qq_dst <= '0;
    end else begin
      waddr_q_dst   <= waddr_qs;
      wdata_q_dst   <= wdata_swp;
      wvalid_q_dst  <= wvalid_qs;
      waddr_qq_dst  <= waddr_q_dst;
      wdata_qq_dst  <= wdata_q_dst;
      wvalid_qq_dst <= wvalid_q_dst;
    end
  end

`line 111 "../src/merl_azadi-II_azadi_spi_host_1.0/rtl/spi_controller_iccm.sv" 0
   
  assign wdata_swp = {wdata_qs[7:0], wdata_qs[15:8], wdata_qs[23:16], wdata_qs[31:24]};

`line 114 "../src/merl_azadi-II_azadi_spi_host_1.0/rtl/spi_controller_iccm.sv" 0
   
  assign sdo_o    = sdo_q;
  assign waddr_o  = waddr_qq_dst;  
  assign wdata_o  = wdata_qq_dst;  
  assign wvalid_o = wvalid_qq_dst;  
endmodule : spi_controller_iccm

`line 121 "../src/merl_azadi-II_azadi_spi_host_1.0/rtl/spi_controller_iccm.sv" 2
