`begin_keywords "1800-2017"
`line 1 "../src/merl_azadi-II_azadi_uart_1.0/rtl/buffer_control.sv" 1

module buffer_control #(
  parameter int BUFFER_DEPTH = 128,
  parameter int BUFFER_WIDTH = 9,
  parameter int ADDR_WIDTH   = 9
)(
  input logic clk_i,
  input logic rst_ni,

`line 10 "../src/merl_azadi-II_azadi_uart_1.0/rtl/buffer_control.sv" 0
  input logic re_i,
  input logic we_i,
  input logic clr_i,
  input logic rst_i,
  input logic [BUFFER_WIDTH-1:0] wdata_i,

`line 16 "../src/merl_azadi-II_azadi_uart_1.0/rtl/buffer_control.sv" 0
  output logic buffer_full,
  output logic [BUFFER_WIDTH:0] rdata_o,
  output logic                  buffer_empty,
  output logic [ADDR_WIDTH-1:0] bsize_o
);

`line 22 "../src/merl_azadi-II_azadi_uart_1.0/rtl/buffer_control.sv" 0
  logic [ADDR_WIDTH:0] raddr;
  logic [ADDR_WIDTH:0] waddr;
  logic msb_comp;
  logic pointer_equal;
  logic fifo_web;
  logic fifo_cen;
  logic [6:0] fifo_addr;
  logic [8:0] rdata;

`line 31 "../src/merl_azadi-II_azadi_uart_1.0/rtl/buffer_control.sv" 0
   
  always_ff @ (posedge clk_i or negedge rst_ni) begin
    if(~rst_ni) begin
      waddr <= '0;
    end else begin
      if(clr_i) begin
	      waddr <= '0;
      end else if(we_i && ~buffer_full) begin
	      waddr <= waddr + 1;
      end
    end
   end

`line 44 "../src/merl_azadi-II_azadi_uart_1.0/rtl/buffer_control.sv" 0
   
  always_ff @ (posedge clk_i or negedge rst_ni) begin
    if(!rst_ni) begin
      raddr <= '0;
    end else begin
      if(clr_i) begin
	      raddr <= '0;
      end else if (re_i & (~buffer_empty)) begin
	      raddr <= raddr + 1;
      end
    end
  end

`line 57 "../src/merl_azadi-II_azadi_uart_1.0/rtl/buffer_control.sv" 0
  always_ff @ (posedge clk_i or negedge rst_ni) begin
    if(!rst_ni) begin
      buffer_full <= 1'b0;
    end else begin
      if(clr_i) begin
	      buffer_full <= 1'b0;
      end else if((waddr >= 8'h7f) & we_i) begin
	      buffer_full <= 1'b1;
      end else if(raddr > 8'h00) begin
	      buffer_full <= 1'b0;
      end
    end
  end

`line 71 "../src/merl_azadi-II_azadi_uart_1.0/rtl/buffer_control.sv" 0
  always_ff @ (posedge clk_i or negedge rst_ni) begin
    if(!rst_ni) begin
      buffer_empty <= 1'b0;
    end else begin
      if(clr_i) begin
	      buffer_empty <= 1'b0;
      end else if((raddr >= 8'h7f) & re_i) begin
	      buffer_empty <= 1'b1;
      end
    end
  end

`line 83 "../src/merl_azadi-II_azadi_uart_1.0/rtl/buffer_control.sv" 0
 sram_fifo#(
  .Width(128),
  .Depth(9)
 ) fifo(
  .data_out	  (rdata),
  .i_clk	(clk_i),
  .read_en	(fifo_cen),
  .write_en	(fifo_web),
  .addr	  (fifo_addr),
  .data_in	  (wdata_i),
  .i_rst (rst_ni)
 );

`line 96 "../src/merl_azadi-II_azadi_uart_1.0/rtl/buffer_control.sv" 0
  assign fifo_web  = ((re_i && (~buffer_empty)) ? 1'b1 : (we_i && (~buffer_full)) ? 1'b0 : 1'b0 );
  assign fifo_addr = ({7{re_i}} & raddr) | ({7{we_i}} & waddr[6:0]);
  assign fifo_cen  = (we_i ? 1'b0 : re_i ? 1'b0 : 1'b1);
  assign rdata_o   = (raddr <= 8'h7f) ? rdata : '0 ;
  assign bsize_o   =  waddr;

`line 102 "../src/merl_azadi-II_azadi_uart_1.0/rtl/buffer_control.sv" 0
endmodule

`line 104 "../src/merl_azadi-II_azadi_uart_1.0/rtl/buffer_control.sv" 2
