`begin_keywords "1800-2017"
`line 1 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 1
module tlul_adapter_reg import tlul_pkg::*; #(
  parameter  int RegAw = 8,
  parameter  int RegDw = 32,  
  localparam int RegBw = RegDw/8
) (
  input logic clk_i,
  input logic rst_ni,

`line 9 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
   
  input  tlul_h2d_t tl_i,
  output tlul_d2h_t tl_o,

`line 13 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
   
  output logic             re_o,
  output logic             we_o,
  output logic [RegAw-1:0] addr_o,
  output logic [RegDw-1:0] wdata_o,
  output logic [RegBw-1:0] be_o,
  input  logic [RegDw-1:0] rdata_i,
  input  logic             error_i
);

`line 23 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
  localparam int IW  = $bits(tl_i.a_source);
  localparam int SZW = $bits(tl_i.a_size);

`line 26 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
  logic outstanding;     
  logic a_ack, d_ack;

`line 29 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
  logic [RegDw-1:0] rdata;
  logic             error, err_internal;

`line 32 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
  logic addr_align_err;      
  logic tl_err;              

`line 35 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
  logic [IW-1:0]         reqid;
  logic [SZW-1:0]        reqsz;
  tlul_pkg::tlul_d_m_op  rspop;

`line 39 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
  logic rd_req, wr_req;

`line 41 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
  assign a_ack   = tl_i.a_valid & tl_o.a_ready;
  assign d_ack   = tl_o.d_valid & tl_i.d_ready;
   
  assign wr_req  = a_ack & ((tl_i.a_opcode == PutFullData) | (tl_i.a_opcode == PutPartialData));
  assign rd_req  = a_ack & (tl_i.a_opcode == Get);

`line 47 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
  assign we_o    = wr_req & ~err_internal;
  assign re_o    = rd_req & ~err_internal;
  assign addr_o  = {tl_i.a_address[RegAw-1:2], 2'b00};  
  assign wdata_o = tl_i.a_data;
  assign be_o    = tl_i.a_mask;

`line 53 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
  always_ff @(posedge clk_i or negedge rst_ni) begin
    if (!rst_ni)    outstanding <= 1'b0;
    else if (a_ack) outstanding <= 1'b1;
    else if (d_ack) outstanding <= 1'b0;
  end

`line 59 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
  always_ff @(posedge clk_i or negedge rst_ni) begin
    if (!rst_ni) begin
      reqid <= '0;
      reqsz <= '0;
      rspop <= AccessAck;
    end else if (a_ack) begin
      reqid <= tl_i.a_source;
      reqsz <= tl_i.a_size;
       
      rspop <= (rd_req) ? AccessAckData : AccessAck ;
    end
  end

`line 72 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
  always_ff @(posedge clk_i or negedge rst_ni) begin
    if (!rst_ni) begin
      rdata  <= '0;
      error <= 1'b0;
    end else if (a_ack) begin
      rdata <= (err_internal) ? '1 : rdata_i;
      error <= error_i | err_internal;
    end
  end

`line 82 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
  assign tl_o = '{
    a_ready:  ~outstanding,
    d_valid:  outstanding,
    d_opcode: rspop,
    d_param:  '0,
    d_size:   reqsz,
    d_source: reqid,
    d_sink:   '0,
    d_data:   rdata,
    d_error: error
  };

`line 94 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
   
   
   
  assign err_internal = addr_align_err | tl_err ;

`line 99 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
   
   
   
   
  always_comb begin
    if (wr_req) begin
       
      addr_align_err = |tl_i.a_address[1:0];
    end else begin
       
      addr_align_err = 1'b0;
    end
  end

`line 113 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
   
 tlul_err u_err (
    .tl_i (tl_i),
    .err_o (tl_err)
  );

`line 119 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 0
endmodule

`line 121 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_adapter_reg.sv" 2
