`begin_keywords "1800-2017"
`line 1 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_err_resp.sv" 1

 
 
 
 
module tlul_err_resp (
  input  logic              clk_i,
  input  logic              rst_ni,
  input  tlul_pkg::tlul_h2d_t tl_h_i,
  output tlul_pkg::tlul_d2h_t tl_h_o
);
  import tlul_pkg::*;

`line 14 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_err_resp.sv" 0
  tlul_pkg::tlul_a_m_op        err_opcode;
  logic [$bits(tl_h_i.a_source)-1:0] err_source;
  logic [$bits(tl_h_i.a_size)-1:0]   err_size;
  logic                              err_req_pending, err_rsp_pending;

`line 19 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_err_resp.sv" 0
  always_ff @(posedge clk_i or negedge rst_ni) begin
    if (!rst_ni) begin
      err_req_pending <= 1'b0;
      err_source      <= {tlul_pkg::TL_AIW{1'b0}};
      err_opcode      <= tlul_pkg::Get;
      err_size        <= '0;
    end else if (tl_h_i.a_valid && tl_h_o.a_ready) begin
      err_req_pending <= 1'b1;
      err_source      <= tl_h_i.a_source;
      err_opcode      <= tl_h_i.a_opcode;
      err_size        <= tl_h_i.a_size;
    end else if (!err_rsp_pending) begin
      err_req_pending <= 1'b0;
    end
  end

`line 35 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_err_resp.sv" 0
  assign tl_h_o.a_ready  = ~err_rsp_pending & ~(err_req_pending & ~tl_h_i.d_ready);
  assign tl_h_o.d_valid  = err_req_pending | err_rsp_pending;
  assign tl_h_o.d_data   = '1;  
  assign tl_h_o.d_source = err_source;
  assign tl_h_o.d_sink   = '0;
  assign tl_h_o.d_param  = '0;
  assign tl_h_o.d_size   = err_size;
  assign tl_h_o.d_opcode = (err_opcode == tlul_pkg::Get) ? AccessAckData : AccessAck;
  assign tl_h_o.d_error  = 1'b1;

`line 45 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_err_resp.sv" 0
  always_ff @(posedge clk_i or negedge rst_ni) begin
    if (!rst_ni) begin
      err_rsp_pending <= 1'b0;
    end else if ((err_req_pending || err_rsp_pending) && !tl_h_i.d_ready) begin
      err_rsp_pending <= 1'b1;
    end else begin
      err_rsp_pending <= 1'b0;
    end
  end

`line 55 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_err_resp.sv" 0
endmodule

`line 57 "../src/merl_azadi-II_azadi_common_1.0/rtl/tlul_err_resp.sv" 2
